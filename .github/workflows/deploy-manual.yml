name: Manual Deployment

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Target environment"
        required: true
        type: choice
        options:
          - production
          - staging
          - qa
          - dev
      outcome:
        description: "Simulated deployment outcome"
        required: true
        type: choice
        options:
          - success
          - failure
      description:
        description: "Deployment description (optional)"
        required: false
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Start deployment
        uses: bobheadxi/deployments@v1
        id: deployment
        with:
          step: start
          env: ${{ inputs.environment }}
          desc: ${{ inputs.description || format('Manual {0} deployment', inputs.environment) }}
          override: true
          debug: true

      - name: Simulate deployment
        run: |
          echo "Deploying to ${{ inputs.environment }}..."
          sleep 5
          if [ "${{ inputs.outcome }}" = "failure" ]; then
            echo "Simulating deployment failure!"
            exit 1
          fi
          echo "Deployment succeeded."

      - name: Finish deployment
        uses: bobheadxi/deployments@v1
        if: always()
        with:
          step: finish
          status: ${{ job.status }}
          env: ${{ steps.deployment.outputs.env }}
          deployment_id: ${{ steps.deployment.outputs.deployment_id }}
          env_url: "https://example.com/${{ inputs.environment }}"
          debug: true
